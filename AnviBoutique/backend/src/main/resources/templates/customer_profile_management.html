<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <title>Manage Profile - Anvi Studio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    :root{ --brand:#ff7c04; --dark:#222; }
    body { font-family: 'Roboto', sans-serif; background-color: #f7f7f7; display: flex; flex-direction: column; min-height: 100vh; }
    .main-content { flex-grow: 1; }
    .btn-brand { background-color: var(--brand); border-color: var(--brand); color: white; }
    .btn-brand:hover { background-color: #cc6300; border-color: #cc6300; }
    .profile-card { border-radius: 12px; }
  </style>
</head>
<body>

<div th:insert="~{navbar.html :: main-navbar(currentPage='profile', customer=${customer})}"></div>

<div class="main-content container mt-5">
  <h1 class="mb-4 display-6 fw-bold">Manage Your Profile</h1>

  <div th:if="${successMessage}" class="alert alert-success" role="alert" th:text="${successMessage}"></div>
  <div th:if="${errorMessage}" class="alert alert-danger" role="alert" th:text="${errorMessage}"></div>

  <div class="card profile-card shadow p-4 mb-5">
    <h4 class="card-title mb-4">Personal & Login Details</h4>

    <form th:action="@{/customer/profile/update}" method="post">

      <input type="hidden" name="currentUsername" th:value="${customer.user.username}">

      <fieldset class="mb-4 pb-3 border-bottom">
        <legend class="h6 text-primary">Account Credentials</legend>
        <div class="row g-3">
          <div class="col-md-6">
            <label for="username" class="form-label">Email Address (Login ID)</label>
            <input type="email" name="username" id="username" class="form-control" th:value="${customer.user.username}" required>
            <div class="form-text text-danger" th:if="${!customer.user.emailVerified}">
              <i class="fa fa-exclamation-triangle"></i> **WARNING:** Account is unverified. Changing your email requires **re-verification**.
            </div>
          </div>
          <div class="col-md-6">
            <label for="phoneNumber" class="form-label">Phone Number</label>
            <input type="tel" name="phoneNumber" id="phoneNumber" class="form-control" th:value="${customer.phoneNumber}" required>
          </div>
        </div>
        <p class="mt-3 mb-0 small"><a th:href="@{/forgot-password}">Change Password</a></p>
      </fieldset>

      <fieldset class="mb-4">
        <legend class="h6 text-primary">Personal Information</legend>
        <div class="row g-3">
          <div class="col-md-6">
            <label for="firstName" class="form-label">First Name</label>
            <input type="text" name="firstName" id="firstName" class="form-control" th:value="${customer.firstName}" required>
          </div>
          <div class="col-md-6">
            <label for="lastName" class="form-label">Last Name</label>
            <input type="text" name="lastName" id="lastName" class="form-control" th:value="${customer.lastName}" required>
          </div>
          <div class="col-md-4">
            <label for="preferredSize" class="form-label">Preferred Size</label>
            <select name="preferredSize" id="preferredSize" class="form-select">
              <option value="">Select (Optional)</option>
              <option value="XS" th:selected="${customer.preferredSize == 'XS'}">XS</option>
              <option value="S" th:selected="${customer.preferredSize == 'S'}">S</option>
              <option value="M" th:selected="${customer.preferredSize == 'M'}">M</option>
              <option value="L" th:selected="${customer.preferredSize == 'L'}">L</option>
              <option value="XL" th:selected="${customer.preferredSize == 'XL'}">XL</option>
              <option value="XXL" th:selected="${customer.preferredSize == 'XXL'}">XXL</option>
            </select>
          </div>
          <div class="col-md-4">
            <label for="gender" class="form-label">Gender</label>
            <select name="gender" id="gender" class="form-select">
              <option value="">Select (Optional)</option>
              <option value="FEMALE" th:selected="${customer.gender == 'FEMALE'}">Female</option>
              <option value="MALE" th:selected="${customer.gender == 'MALE'}">Male</option>
              <option value="UNISEX" th:selected="${customer.gender == 'UNISEX'}">Unisex</option>
              <option value="OTHER" th:selected="${customer.gender == 'OTHER'}">Prefer not to say</option>
            </select>
          </div>
          <div class="col-md-4">
            <label for="dateOfBirth" class="form-label">Date of Birth</label>
            <input type="date" name="dateOfBirth" id="dateOfBirth" class="form-control" th:value="${dobFormatted}">
          </div>
        </div>
      </fieldset>

      <fieldset class="mb-4">
        <legend class="h6 text-primary">Preferences</legend>
        <div class="form-check">
          <input type="checkbox" name="newsletterOptIn" id="newsletterOptIn" class="form-check-input" th:checked="${customer.newsletterOptIn}">
          <label class="form-check-label" for="newsletterOptIn">
            Sign me up for the Anvi Studio newsletter (exclusive offers).
          </label>
        </div>
        <div class="form-text text-muted small mt-2">
          Terms of Service accepted: <i class="fa fa-check text-success"></i> (Cannot be changed)
        </div>
      </fieldset>

      <button type="submit" class="btn btn-brand w-100 mt-3">
        <i class="fa fa-save me-2"></i> Save Profile Updates
      </button>
    </form>
  </div>

  <a th:href="@{/}" class="btn btn-secondary"><i class="fa fa-arrow-left me-2"></i> Back to Shopping</a>
</div>

<div th:replace="~{footer.html :: footer}"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>