<div xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" th:fragment="main-navbar">
    <!-- Offer bar (Sticky top content before main nav) -->
    <div class="offer-bar text-center">
        <div class="container">Free Shipping on Orders Above ₹1999 — Use code <a href="#" style="color:var(--brand); text-decoration:none; font-weight:600;">FREESHIP</a></div>
    </div>

    <!-- NAVBAR: Start of Reusable Nav Block -->
    <nav class="navbar navbar-expand-lg main-nav">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" th:href="@{/}">
                <img th:src="@{/images/Chaknik_Logo.png}" alt="Anvi Studio Logo" style="height:75px; margin-right:4px;">
                <span class="text-white">Anvi Studio</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="mainNav">

                <!-- 1. UNIFIED SEARCH BAR (Aligned left, before main links) -->
                <form th:action="@{/products}" method="get" class="d-flex me-4 my-2 my-lg-0">
                    <div class="input-group">
                        <input type="search" name="keyword" class="form-control form-control-sm" placeholder="Search products, SKU, color..." aria-label="Search" style="width: 250px;">
                        <button class="btn btn-outline-light btn-sm" type="submit">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>
                </form>

                <!-- 2. MAIN LINKS -->
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <!-- The active class should be dynamically applied by each page when using this fragment -->
                    <li class="nav-item"><a class="nav-link" th:href="@{/}" th:classappend="${currentPage == 'home' ? 'active' : ''}">Home</a></li>
                    <li class="nav-item"><a class="nav-link" th:href="@{/products(sort='newest')}" th:classappend="${currentPage == 'newArrivals' ? 'active' : ''}">New Arrivals</a></li>

                    <!-- SHOP DROPDOWN -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="shopDropdown" role="button" data-bs-toggle="dropdown" th:classappend="${currentPage == 'shop' ? 'active' : ''}">Shop</a>
                        <ul class="dropdown-menu" aria-labelledby="shopDropdown">
                            <li><a class="dropdown-item" th:href="@{/products(category='Long Frocks')}">Long Frocks</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Lehengas')}">Lehengas</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Mom & Me')}">Mom & Me</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Crop Top – Skirts')}">Crop Top – Skirts</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Handlooms')}">Handlooms</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Casual Frocks')}">Casual Frocks</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Ready To Wear')}">Ready To Wear</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Dupattas')}">Dupattas</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Kids wear')}">Kids wear</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Dress Material')}">Dress Material</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Sarees')}">Sarees</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Blouses')}">Blouses</a></li>
                            <li><a class="dropdown-item" th:href="@{/products(category='Fabrics')}">Fabrics</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" th:href="@{/products}">All Products</a></li>
                        </ul>
                    </li>
                    <li class="nav-item"><a class="nav-link" th:href="@{/about}" th:classappend="${currentPage == 'about' ? 'active' : ''}">About</a></li>
                    <li class="nav-item"><a class="nav-link" th:href="@{/contact}" th:classappend="${currentPage == 'contact' ? 'active' : ''}">Contact</a></li>
                    <!-- <li class="nav-item"><a class="nav-link" th:href="@{/custom-request}" th:classappend="${currentPage == 'customRequest' ? 'active' : ''}">Custom Request</a></li>-->
                </ul>

                <!-- 3. ICON GROUP (Right side) -->
                <ul class="navbar-nav mb-2 mb-lg-0">

                    <!-- NEW: MY ACCOUNT DROPDOWN (Replaces existing welcome/login block) -->
                    <!-- Show Login button if not authenticated -->
                    <li class="nav-item" sec:authorize="!isAuthenticated()">
                        <a class="nav-link" th:href="@{/login}" title="Login">
                            <i class="fa fa-user"></i> Login
                        </a>
                    </li>

                    <!-- Show Dropdown menu if authenticated (Customer/Admin) -->
                    <li class="nav-item dropdown" sec:authorize="isAuthenticated()">
                        <!-- Dropdown Toggle Button/Link -->
                        <a class="nav-link dropdown-toggle text-white" href="#" id="accountDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" title="My Account">
                            <i class="fa fa-user-circle me-1"></i>
                            <!-- Displaying the customer's first name if available -->
                            <span th:if="${customer != null}" th:text="${customer.firstName}">Customer</span>
                            <span th:unless="${customer != null}" sec:authentication="name">User</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="accountDropdown">

                            <!-- Common Links -->
                            <li><h6 class="dropdown-header">Manage Account</h6></li>
                            <li><a class="dropdown-item" th:href="@{/customer/profile}"><i class="fa fa-id-card me-2"></i> My Profile</a></li>
                            <li><a class="dropdown-item" th:href="@{/wishlist}"><i class="fa-regular fa-heart me-2"></i> My Wishlist</a></li>
                            <li><hr class="dropdown-divider"></li>

                            <!-- Commerce Links (Placeholder paths need implementation later) -->
                            <li><a class="dropdown-item" th:href="@{/customer/orders}"><i class="fa fa-receipt me-2"></i> My Orders</a></li>
                            <li><a class="dropdown-item" th:href="@{/customer/addresses}"><i class="fa fa-map-marker-alt me-2"></i> Addresses</a></li>
                            <li><a class="dropdown-item" th:href="@{/customer/coupons}"><i class="fa fa-tag me-2"></i> Coupons & Offers</a></li>
                            <li><a class="dropdown-item" th:href="@{/customer/gift-cards}"><i class="fa fa-gift me-2"></i> Gift Cards</a></li>
                            <li><hr class="dropdown-divider"></li>

                            <!-- Logout Action -->
                            <li>
                                <form th:action="@{/logout}" method="post" class="dropdown-item d-flex align-items-center p-0">
                                    <button type="submit" class="btn btn-link text-danger w-100 text-start" style="padding: .25rem 1rem;">
                                        <i class="fa fa-sign-out-alt me-2"></i> Logout
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </li>

                    <!-- WISHLIST ICON (Kept for quick access, but links to the dropdown entry too) -->
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/wishlist-unauth}" sec:authorize="!isAuthenticated()" title="Wishlist">
                            <i class="fa-regular fa-heart"></i>
                        </a>
                        <a class="nav-link" th:href="@{/wishlist}" sec:authorize="isAuthenticated()" title="My Wishlist">
                            <i class="fa-regular fa-heart"></i>
                        </a>
                    </li>

                    <!-- CART ICON -->
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/cart-unauth}" sec:authorize="!isAuthenticated()" title="Cart">
                            <i class="fa fa-shopping-cart"></i>
                        </a>
                        <a class="nav-link" th:href="@{/cart}" sec:authorize="isAuthenticated()" title="My Cart">
                            <i class="fa fa-shopping-cart"></i>
                        </a>
                    </li>

                    <!-- REMOVED: Old Logout Button -->
                    <!-- The logout button is now integrated into the dropdown menu -->

                </ul>
            </div>
        </div>
    </nav>
    <!-- NAVBAR: End of Reusable Nav Block -->
</div>